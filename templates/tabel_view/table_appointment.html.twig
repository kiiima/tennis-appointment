<style>
  .modal
  {
    transform: translate(-50%, -50%);
  }

</style>

<div class="mb-20 flex flex-row">

  <!--div class="mx-10 mb-10 p-3 flex-shrink-0 flex flex-col"-->
  {{ include('tabel_view/select_section.html.twig', {form:formSelect}) }}
  <!--/div-->

  {% set groundCount = grounds|length + 1 %}

  <table class="border border-collapse border-slate-200 px-10 py-10 table-auto flex-grow mx-10 mb-10">
    <!--naziv kolona-->
    <tr class="m-2">
      <th class="p-2 border border-slate-300 w-1/{{groundCount}}">
        Time
      </th>
      {% for ground in grounds %}
        <th class="p-2 border border-slate-300 w-1/{{groundCount}}">
          {{ground.name}}
        </th>
      {% endfor %}
    </tr>

    {% for i in range(start_time,end_time-1) %}
      <tr class="m-2">
        {% for j in range(1,grounds|length+1) %}
          <td class="p-2 border border-slate-300 text-center w-1/{{groundCount}}">
            {% if j == 1 %}
              {% if i in range(8,9) %}
                0{{i}}:00  
              {% else %}
                 {{i}}:00
              {% endif %}
            {% else %}

              <!--ako pripada zakazanim terminima prikazi ih-->
              {% set oneTime = true %}

              {% for appoint in appointments %}
              {% set aa = j-1 %}
              {% set aaa = "Ground" ~ aa %}
                <!--ovaj termin je zakazan-->
                {% if appoint.time == i and appoint.ground.name == aaa %}
                  {% set oneTime = false %}
                  {% if is_granted('ROLE_ADMIN') %}
                    <button class="p-2 w-full bg-lime-300 text-amber-950">
                      {{appoint.user.email}}
                    </button>
                  {% else %}
                      <button class="p-2 {{app.user == appoint.user ? 'w-full bg-amber-200 text-amber-950 inline-block' : 'w-full disabled bg-lime-300 text-lime-300' }}">
                        my appointment
                      </button>
                  {% endif %}
                {% endif %}
              {% endfor %}

              <!--ovaj termni nije zakazan-->
              {% if is_granted('ROLE_VERIFY') %}
                <!--imamo verifikovanog korisnika-->
                {% if oneTime == true %}
                  {% set oneTime = false %}
                  {% set index = j - 2 %}

                  {% set thisGround = grounds[index] %}
                  <button data-modal-target="#modal" 
                    onclick="openPopUp('{{i}}','{{thisGround.name }}','{{app.user.email }}','{{selectDate}}')"
                    class="p-2 w-full {{app.user == null ? 'disabled' : '' }} bg-white text-white {{ app.user.email != adminEmail ? 'hover:bg-lime-700 hover:text-amber-950':'' }}">
                    booking
                  </button>

                {% endif %}
              {% else %}
                <!--korisnik nije verifikovan-->
                {% if oneTime == true %}
                  {% set oneTime = false %}
                  <button class="disabled p-2 w-full bg-white text-white">
                    booking
                  </button>  
                {% endif %}
              {% endif %}
              
            {% endif %}
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </table>

  <div class="modal hidden fixed top-1/2 left-1/2 border-1 border-amber-950 rounded-md p-3 z-10 bg-lime-300 w-1/2 max-w-2/3 ease-in-out duration-200" id="modal">
    <div class="modal-header px-15 flex justify-between border-b-1 mr-4 mb-5">
      <h3 class="title text-xl text-bold">
        Booking appointment
      </h3>
      <button id="close-button" class="close-button text-bold text-3xl mr-4 hover:cursor-pointer" onclick="closePopUp()">
        &times;
      </button>
    </div>
    <div class="modal-body">
      {{form_start(formBooking,{'attr' :{'class':'grid grid-col-2 gap-3 '} })}}
          <div class="flex flex-col">
            {{form_label(formBooking.hourlyRate)}}
            {{form_widget(formBooking.hourlyRate, {'attr':{'class':'js-time'} })}}
          </div>
  
          <div class="flex flex-col">
            {{form_label(formBooking.bookGround)}}
            {{form_widget(formBooking.bookGround,{'attr':{'class':'js-ground'} })}}
          </div>

        <div class="flex flex-col">
          {{form_label(formBooking.username)}}
          {{form_widget(formBooking.username,{'attr':{'class':'js-username'} })}}
        </div>

        <div class="flex flex-col">
          {{form_label(formBooking.dateSelect)}}
          {{form_widget(formBooking.dateSelect,{'attr':{'class':'js-date'} })}}
        </div>

        <div>
          <button class="bg-lime-600 text-amber-950 w-1/2" type="submit">
            Booked
          </button>
        </div>
      {{form_end(formBooking)}}
    </div>
  </div>
  <div class="overlay fixed top-0 bottom-0 right-0 left-0 bg-black opacity-50 z-2 hidden" id="overlay"></div>
</div>


<script>

function openPopUp(i,groundName,username,selectDate) {
  document.querySelector('.js-time').value = i;
  document.querySelector('.js-ground').value = groundName;
  document.querySelector('.js-username').value = username;
  document.querySelector('.js-date').value = selectDate;

  var modal =document.getElementById("modal").style.display = "block";
  document.getElementById("overlay").style.display = "block";

}

function closePopUp() {
  document.getElementById("modal").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}

</script>